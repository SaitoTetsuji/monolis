<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONOLIS</title>
    <!--スタイルシートの読み込み-->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="quill.css">
    <link rel="stylesheet" href="menu.css">
    <script src="https://monolis.f5.si/js/api_access.js"></script>
    <script>const api = new MonolisAPI("monolis.f5.si/api");</script>
</head>
<body>
     <!--「ヘッダー」　時々のファイル名を登録したい-->
     <header>
        <script>
          document.addEventListener("DOMContentLoaded", function() {
          const urlParams = new URLSearchParams(window.location.search);
          const filename = urlParams.get("filename");
  
          // ファイル名を表示
          const filenameElement = document.getElementById("filename");
          filenameElement.textContent = filename;
          });
        </script>
        <h1 class="title"> 
          <span id="filename"></span>
        </h1>
        <nav class="nav">
          <ul class="menu-group">
            <li class="menu-item"><a href="#">設定</a></li>
            <li class="menu-item"><a href="list.html">ものリスト</a></li>
          </ul>
        </nav>
    </header>
    
    <!--エディタコンテナの作成-->
    <div id="editor">
         <p id="content"></p>
    </div>

    <button id="viewContentButton">内容を表示</button>

    <script>
        document.getElementById("viewContentButton").addEventListener("click", function() {
            // "content"要素の内容を取得
            const contentElement = document.getElementById("content");
            const content = contentElement.textContent;

            // URLパラメータに内容を追加して次のページに遷移
            window.location.href = `editer.html?content=${encodeURIComponent(content)}`;
        });
    </script>
    
    <!--Quillライブラリの読み込み-->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
   
    <!--Quillエディタの初期化-->
    <script src="quill.js"></script>

     <!--管理画面スライドメニューのコード-->
     <div id="slide-menu">
      <h2>管理画面</h2>
        
        <p>公開範囲設定<br>
          <label for="checkbox1">
            <input type="checkbox" id="checkbox1" onchange="updateCheckboxes(1)"> 公開
          </label><br>
          <label for="checkbox2">
            <input type="checkbox" id="checkbox2" onchange="updateCheckboxes(2)"> 非公開
          </label><br>
          
          <div id="text-container" style="display: none;">
            公開アカウント設定<br>
            <label for="page-allowed_user_ids">公開を許可するユーザー：</label>
            <input type="text" id="page-allowed_user_ids" required>
            <button onclick="addItem1()">追加</button>
            <ul id="allowed_user_ids_disp"></ul><br>
            <label for="page-co_editor_user_ids">共同編集を可能にするユーザー：</label>
            <input type="text" id="page-co_editor_user_idsd" required>
            <button onclick="addItem2()">追加</button>
            <ul id="co_editor_user_idsd_disp"></ul><br>
        
            <!-- 公開するユーザーのリストの追加 -->
            <script>
              var allowed_user_idsList = [];  // 空の配列を作成
        
              function addItem1() {
                var inputElement = document.getElementById("page-allowed_user_ids");
                var inputValue = inputElement.value;
        
                if (inputValue.trim() !== "") {
                  allowed_user_idsList.push(inputValue);  // テキスト情報を配列に追加
        
                  var newItem = document.createElement("li");
                  newItem.appendChild(document.createTextNode(inputValue));
        
                  var allowed_user_ids_disp = document.getElementById("allowed_user_ids_disp");
                  allowed_user_ids_disp.appendChild(newItem);
        
                  inputElement.value = "";
                  updateCheckboxes();
                }
              }
            </script>
        
            <!-- 共同編集するユーザーのリストの追加 -->
            <script>
              var co_editor_user_idsdsList = [];  // 空の配列を作成
        
              function addItem2() {
                var inputElement = document.getElementById("page-co_editor_user_idsd");
                var inputValue = inputElement.value;
        
                if (inputValue.trim() !== "") {
                  co_editor_user_idsdsList.push(inputValue);  // テキスト情報を配列に追加
        
                  var newItem = document.createElement("li");
                  newItem.appendChild(document.createTextNode(inputValue));
        
                  var co_editor_user_idsd_disp = document.getElementById("co_editor_user_idsd_disp");
                  co_editor_user_idsd_disp.appendChild(newItem);
        
                  inputElement.value = "";
                  updateCheckboxes();
                }
              }
            </script>
              
            公開パスワード
            <div id="form-container">
              <form>
                <input type="text" id="password" placeholder="パスワードを入力" oninput="updateCheckboxes(3)">
              </form>
            </div>
          </div>
          
          <input type="hidden" id="access_type" value="0"> <!-- 初期値は0 -->
        
          <script>
            function updateCheckboxes(checkboxNumber) {
              var textContainer = document.getElementById("text-container");
              var passwordInput = document.getElementById("password");
              var checkbox1 = document.getElementById("checkbox1");
              var checkbox2 = document.getElementById("checkbox2");
              var allowedUserIdsInput = document.getElementById("page-allowed_user_ids");
              var coEditorUserIdsInput = document.getElementById("page-co_editor_user_idsd");
              var accessTypeInput = document.getElementById("access_type");
        
              if (checkboxNumber === 1) {
                if (checkbox1.checked) {
                  checkbox2.checked = false;
                  textContainer.style.display = "block";
                  accessTypeInput.value = "0"; // チェックボックス1にチェックが入ったときに1をセット
                } else {
                  textContainer.style.display = "none";
                  accessTypeInput.value = "0";
                }
              } else if (checkboxNumber === 2) {
                if (checkbox2.checked) {
                  checkbox1.checked = false;
                  textContainer.style.display = "none"; // チェックボックス2にチェックがある場合は非表示にする
                  accessTypeInput.value = "2"; // チェックボックス2にチェックが入ったときに2をセット
                } else {
                  textContainer.style.display = "none";
                  accessTypeInput.value = "0";
                }
              } else if (checkboxNumber === 3) {
                if (passwordInput.value.trim() !== "") {
                  accessTypeInput.value = "1";
                } else {
                  accessTypeInput.value = "0";
                }
              }
        
              if (allowed_user_idsList.length > 0 || co_editor_user_idsdsList.length > 0) {
                accessTypeInput.value = "2";
              }
        
              // access_typeの値をコンソールに表示
              console.log("access_type: " + accessTypeInput.value);
            }
          </script>
        </p>

        <p>QRコード作成</p>
        <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.2/qrcode.min.js"></script>
        <div id="qrcode"></div>

        <script src="QR.js"></script>
        <link rel="stylesheet" href="QR.css">

        <!-- CDNの場合 -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.js"></script>
        <div class="qrblock">
          <p class="qrcomment">QRコードで生成したい文字列を入力してください。</p>
          <input id="isbn" type="text" name="isbn" value=""> <button id="getqrInfo" class="btn btn-default">QRコードを生成</button><br>
          <!--<input type="text">-->
        </div>
        <div id="qrOutput">
          <canvas id="qr"></canvas>
          <div><img id="newImg"></div>
        </div>
        <script>
          document.getElementById('getqrInfo').addEventListener('click', () => {
          // 入力された文字列を取得
          var userInput = document.getElementById('isbn').value;
          var query = userInput.split(' ').join('+');
          // QRコードの生成
          (function() {
          var qr = new QRious({
          element: document.getElementById('qr'),
          // 入力した文字列でQRコード生成
          value: query
          });
          qr.background = '#FFF'; //背景色
          qr.backgroundAlpha = 0.8; // 背景の透過率
          qr.foreground = '#6bb6ff'; //QRコード自体の色
          qr.foregroundAlpha = 1.0; //QRコード自体の透過率
          qr.level = 'L'; // QRコードの誤り訂正レベル
          qr.size = 100; // QRコードのサイズ
          // QRコードをflexboxで表示
          document.getElementById('qrOutput').style.display = 'flex';
          })();
          // png出力用コード
          //var cvs = document.getElementById("qr");
          var png = cvs.toDataURL();
          document.getElementById("newImg").src = png;

          });
        </script>

        
    </div>
    
    <div id="menu">
        <!-- メニュー表示・非表示用のボタン -->
        <button id="menu-button">←</button>
    </div>

    <script src="menu.js"> </script>
</body>
</html>