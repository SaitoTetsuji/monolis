<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://monolis.f5.si/js/api_access.js"></script>
<link rel="stylesheet" href="list.css">
<title>MONOLIS</title>
<style>
  ul {
    list-style: none;
  }
  li {
    display: flex;
    align-items: center;
    margin: 10px;
    cursor: pointer;
  }
  .icon {
    width: 60px;
    height: 60px;
    background-color: #3498db;
    text-align: center;
    line-height: 60px;
    color: white;
    font-size: 32px;
    margin-right: 10px;
    cursor: pointer;
  }
  .file-info {
    display: flex;
    flex-direction: column;
  }
  .delete-button {
    background-color: #e74c3c;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
  }
</style>

</head>
<body>
<h1>ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h1>
<ul id="fileList">

</ul>
<button id="addFileButton">ï¼‹ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ </button>




<!--ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã®æ“ä½œ-->
<div class="logout">
  <br>
  <button id="logoutButton">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
</div>

<script>
  const logoutButton = document.getElementById('logoutButton');

  logoutButton.addEventListener('click', async () => {
      try {
          const res = await api.logout();

          if (res.status === 200) {
              // æˆåŠŸã®å‡¦ç†
              alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚');
              window.location.href = 'index.html';
          } else {
              // ã‚¨ãƒ©ãƒ¼å‡¦ç†
              alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          }
      } catch (error) {
          // é€šä¿¡ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
          alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          console.error(error);
      }
  });
</script>

<!--ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å‰Šé™¤-->
<br>
<div class="deleteUser">
  <button id="deleteUserButton">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å‰Šé™¤ã‚’è¡Œã†</button>
</div>

<script>
const api = new MonolisAPI("monolis.f5.si/api");

const fileList = document.getElementById("fileList");
const addFileButton = document.getElementById("addFileButton");

function addItem(pageData){
  const newFileName = pageData.title;
  const id = pageData.id;
  const thumbnail = pageData.thumbnail;
  const newFileItem = document.createElement("li");

  if(pageData.content == ""){
    const icon = document.createElement("div");
    icon.classList.add("icon");
    icon.textContent = "ğŸ“„";
    newFileItem.appendChild(icon);
  }else{
    const icon = document.createElement("img");
    icon.classList.add("icon");
    icon.src = thumbnail;
    newFileItem.appendChild(icon);
  }

  const fileInfo = document.createElement("div");
  fileInfo.classList.add("file-info");
  fileInfo.textContent = newFileName;
  newFileItem.appendChild(fileInfo);

  const deleteButton = document.createElement("button");
  deleteButton.classList.add("delete-button");
  deleteButton.textContent = "å‰Šé™¤";
  newFileItem.appendChild(deleteButton);

  newFileItem.addEventListener("click", function(event) {
    if (event.target.classList.contains("delete-button")) {
      api.deletePage(id).then(res => {
        if(res.status === 200){
            // æˆåŠŸã®å‡¦ç†
            newFileItem.remove();
        } else if(res.status === 404){
            // ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¾ãŸã¯å‰Šé™¤æ¨©é™ãŒãªã„å ´åˆã®å‡¦ç†
        } else {
            // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
        }
    });
      return;
    }

  // ãƒ•ã‚¡ã‚¤ãƒ«é …ç›®ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
  newFileItem.addEventListener("click", function() {
  const targetFilePath = "monolis.html"; // è‡ªä½œã—ãŸãƒšãƒ¼ã‚¸ã®ç›¸å¯¾ãƒ‘ã‚¹
  const urlWithParameter = `${targetFilePath}?filename=${encodeURIComponent(newFileName)}&id=${id}`;
  window.location.href = urlWithParameter;
  });
  });

  fileList.appendChild(newFileItem);
}

document.addEventListener("DOMContentLoaded", function() {


  const deleteUser = document.getElementById('deleteUserButton');
  
            
  deleteUser.addEventListener('click', async function() {
    const confirmed = confirm('æœ¬å½“ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');
    if (confirmed) { 
    try {
      const res = await api.deleteUser();
      if (res.status === 200) {
          // æˆåŠŸã®å‡¦ç†
          alert('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
          window.location.href = 'index.html';
      } else if (res.status === 404) {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®å‡¦ç†
        alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
      } else {
        // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
      }
    } catch (error) {
      // é€šä¿¡ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
      alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
      console.error(error);
    }
}});

  api.getPages().then(res => {
    if(res.status === 200){
        // æˆåŠŸã®å‡¦ç†
        let pages = res.data; // ãƒšãƒ¼ã‚¸ä¸€è¦§
        for( var i=0; i<pages.length; i++ ) {

          console.log( pages[i] );
          addItem(pages[i]);
        }

    } else {
        // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    }
  });


  addFileButton.addEventListener("click", async function() {
    const newFileName = prompt("æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", "æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«");

    let page = {
      "title": newFileName,
      "content": "",
      "access_type": 2,
      "password": "",
      "allowed_user_ids": [],
      "co_editor_user_ids": []
    };

    api.createPage(page).then(res => {
        if(res.status === 200){
          // æˆåŠŸã®å‡¦ç†
          if (newFileName) {
            addItem(res.data);
          }
        } else {
          // ã‚¨ãƒ©ãƒ¼å‡¦ç†
          alart(error);
        }
    });




 }) ;


 
});
</script>
</body>
</html>