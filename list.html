<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://monolis.f5.si/js/api_access.js"></script>
<link rel="stylesheet" href="list.css">
<title>MONOLIS</title>



</head>
<body>
<h1>сЃЋсѓАсѓцсЃФСИђУдД</h1>
<ul id="fileList">

</ul>
<button id="addFileButton">№╝І Тќ░УдЈсЃЋсѓАсѓцсЃФУ┐йтіа</button>




<!--сЃГсѓ░сѓбсѓдсЃѕсЂ«ТЊЇСйю-->
<div class="logout">
  <br>
  <button id="logoutButton">сЃГсѓ░сѓбсѓдсЃѕ</button>
</div>

<script>
  const logoutButton = document.getElementById('logoutButton');

  logoutButton.addEventListener('click', async () => {
      try {
          const res = await api.logout();

          if (res.status === 200) {
              // ТѕљтіЪсЂ«тЄдуљє
              alert('сЃГсѓ░сѓбсѓдсЃѕсЂЌсЂЙсЂЌсЂЪсђѓ');
              window.location.href = 'index.html';
          } else {
              // сѓесЃЕсЃ╝тЄдуљє
              alert('сЃГсѓ░сѓбсѓдсЃѕТЎѓсЂФсѓесЃЕсЃ╝сЂїуЎ║ућЪсЂЌсЂЙсЂЌсЂЪсђѓсѓѓсЂєСИђт║дсЂіУЕдсЂЌсЂЈсЂасЂЋсЂёсђѓ');
          }
      } catch (error) {
          // жђџС┐АсѓесЃЕсЃ╝сЂ«тЄдуљє
          alert('жђџС┐АсѓесЃЕсЃ╝сЂїуЎ║ућЪсЂЌсЂЙсЂЌсЂЪсђѓсѓѓсЂєСИђт║дсЂіУЕдсЂЌсЂЈсЂасЂЋсЂёсђѓ');
          console.error(error);
      }
  });
</script>

<!--сЃдсЃ╝сѓХсЃ╝ТЃЁта▒сЂ«тЅіжЎц-->
<br>
<div class="deleteUser">
  <button id="deleteUserButton">сѓбсѓФсѓдсЃ│сЃѕсЂ«тЅіжЎцсѓњУАїсЂє</button>
</div>

<script>
const api = new MonolisAPI("monolis.f5.si/api");

const fileList = document.getElementById("fileList");
const addFileButton = document.getElementById("addFileButton");

function addItem(pageData){
  const newFileName = pageData.title;
  const id = pageData.id;
  const thumbnail = pageData.thumbnail;
  const newFileItem = document.createElement("li");

  if(pageData.content == ""){
    const icon = document.createElement("div");
    icon.classList.add("icon");
    icon.textContent = "­ЪЊё";
    newFileItem.appendChild(icon);
  }else{
    const icon = document.createElement("img");
    icon.classList.add("icon");
    icon.src = thumbnail;
    newFileItem.appendChild(icon);
  }

  const fileInfo = document.createElement("div");
  fileInfo.classList.add("file-info");
  fileInfo.textContent = newFileName;
  newFileItem.appendChild(fileInfo);

  const deleteButton = document.createElement("button");
  deleteButton.classList.add("delete-button");
  deleteButton.textContent = "тЅіжЎц";
  newFileItem.appendChild(deleteButton);

  newFileItem.addEventListener("click", function(event) {
    if (event.target.classList.contains("delete-button")) {
      api.deletePage(id).then(res => {
        if(res.status === 200){
            // ТѕљтіЪсЂ«тЄдуљє
            newFileItem.remove();
        } else if(res.status === 404){
            // сЃџсЃ╝сѓИсЂїУдІсЂцсЂІсѓЅсЂфсЂёсђЂсЂЙсЂЪсЂ»тЅіжЎцТеЕжЎљсЂїсЂфсЂёта┤тљѕсЂ«тЄдуљє
        } else {
            // сЂЮсЂ«С╗ќсЂ«сѓесЃЕсЃ╝тЄдуљє
        }
    });
      return;
    }

  // сЃЋсѓАсѓцсЃФжаЁуЏ«сЂФсѓ»сЃфсЃЃсѓ»сѓцсЃЎсЃ│сЃѕсѓњУ┐йтіа
  newFileItem.addEventListener("click", function() {
  const targetFilePath = "monolis.html"; // УЄфСйюсЂЌсЂЪсЃџсЃ╝сѓИсЂ«уЏИт»ЙсЃЉсѓ╣
  const urlWithParameter = `${targetFilePath}?filename=${encodeURIComponent(newFileName)}&id=${id}`;
  window.location.href = urlWithParameter;
  });
  });

  fileList.appendChild(newFileItem);
}

document.addEventListener("DOMContentLoaded", function() {


  const deleteUser = document.getElementById('deleteUserButton');
  
            
  deleteUser.addEventListener('click', async function() {
    const confirmed = confirm('ТюгтйЊсЂФсѓбсѓФсѓдсЃ│сЃѕТЃЁта▒сѓњтЅіжЎцсЂЌсЂдсѓѓсѓѕсѓЇсЂЌсЂёсЂДсЂЎсЂІ№╝Ъ');
    if (confirmed) { 
    try {
      const res = await api.deleteUser();
      if (res.status === 200) {
          // ТѕљтіЪсЂ«тЄдуљє
          alert('сѓбсѓФсѓдсЃ│сЃѕТЃЁта▒сѓњтЅіжЎцсЂЌсЂЙсЂЌсЂЪсђѓ');
          window.location.href = 'index.html';
      } else if (res.status === 404) {
        // сЃдсЃ╝сѓХсЃ╝сЂїУдІсЂцсЂІсѓЅсЂфсЂёта┤тљѕсЂ«тЄдуљє
        alert('сЃдсЃ╝сѓХсЃ╝сЂїУдІсЂцсЂІсѓісЂЙсЂЏсѓЊсђѓ');
      } else {
        // сЂЮсЂ«С╗ќсЂ«сѓесЃЕсЃ╝тЄдуљє
        alert('сѓесЃЕсЃ╝сЂїуЎ║ућЪсЂЌсЂЙсЂЌсЂЪсђѓсѓѓсЂєСИђт║дсЂіУЕдсЂЌсЂЈсЂасЂЋсЂёсђѓ');
      }
    } catch (error) {
      // жђџС┐АсѓесЃЕсЃ╝сЂ«тЄдуљє
      alert('жђџС┐АсѓесЃЕсЃ╝сЂїуЎ║ућЪсЂЌсЂЙсЂЌсЂЪсђѓсѓѓсЂєСИђт║дсЂіУЕдсЂЌсЂЈсЂасЂЋсЂёсђѓ');
      console.error(error);
    }
}});

  api.getPages().then(res => {
    if(res.status === 200){
        // ТѕљтіЪсЂ«тЄдуљє
        let pages = res.data; // сЃџсЃ╝сѓИСИђУдД
        for( var i=0; i<pages.length; i++ ) {

          console.log( pages[i] );
          addItem(pages[i]);
        }

    } else {
        // сѓесЃЕсЃ╝тЄдуљє
    }
  });


  addFileButton.addEventListener("click", async function() {
    const newFileName = prompt("Тќ░сЂЌсЂёсЃЋсѓАсѓцсЃФтљЇсѓњтЁЦтіЏсЂЌсЂдсЂЈсЂасЂЋсЂё:", "Тќ░УдЈсЃЋсѓАсѓцсЃФ");

    let page = {
      "title": newFileName,
      "content": "",
      "access_type": 2,
      "password": "",
      "allowed_user_ids": [],
      "co_editor_user_ids": []
    };

    api.createPage(page).then(res => {
        if(res.status === 200){
          // ТѕљтіЪсЂ«тЄдуљє
          if (newFileName) {
            addItem(res.data);
          }
        } else {
          // сѓесЃЕсЃ╝тЄдуљє
          alart(error);
        }
    });




 }) ;


 
});
</script>
</body>
</html>